---
title: "Bioinformatics Project II"
author: "Emily Mynar & Anna Rees"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=TRUE}
knitr::opts_chunk$set(echo = TRUE,
                      # warning = FALSE,
                      # message = FALSE,
                      fig.align = "center")

pacman::p_load(dplyr, ggplot2, DESeq2, tidyverse)

theme_set(theme_bw())
```

## 


```{r read files}

meta <- read.table(file = './Data/SRP059735/metadata_SRP059735.tsv',
           sep = '\t',
           header = TRUE)

janitor::clean_names(meta)
```



```{r clean meta file}
meta_clean <-
  
meta |>
  # Changing columns to choose based on how our dataset is stored
  mutate('sample' = refinebio_accession_code,
         'title' = as.factor(refinebio_title)) |>
  separate(col = refinebio_title,
           into = c('donor', 'donor_ID', 'treatment'),
           sep = ' ') |>
  select(sample, title, donor_ID)
  
meta_clean
```
```{r read counts matrix}
# Read in counts matrix
data <- read.table(file = './Data/SRP059735/SRP059735.tsv',
           sep = '\t',
           header = TRUE)

tibble(data)
```
```{r check identical}
# TODO: FIX THIS LATER

identical(colnames(data), meta_clean$Sample)

```

```{r change column names}

colnames(data) <- c('gene', 'Donor 97 pDC', 'Donor 97 CD1c+ mDC', 'Donor 97 SLAN DC', 'Donor 97 CD14+ mono', 'Donor 28 pDC', 'Donor 28 CD1c+ mDC', 
                    'Donor 28 SLAN DC', 'Donor 28 CD14+ Mono', 'Donor 36 CD1c+ mDC', 'Donor 36 SLAN DC')

```

```{r pivot data}

data_long <-
  pivot_longer(data = data,
               cols = -gene,
               names_to = 'ID',
               values_to = 'reads') |>
  
  mutate('sample_ID' = ID) |>
  
  separate(col = 'ID',
           into = c('donor', 'donor_ID', 'treatment'),
           sep = ' ') |>
  
  mutate(donor_ID = as.factor(donor_ID)) |>
  
  select(sample_ID, donor_ID, reads, gene)

tibble(data_long)

```
```{r check quality}

ggplot(data = data_long,
       mapping = aes(x = sample_ID)) +
  
  geom_col(data = data_long |> group_by(sample_ID, donor_ID) |> summarize('sum' = sum(reads)),
           mapping = aes(y = sum,
                         fill = donor_ID)) +
  
  labs(x = 'Sample ID',
       y = 'Total Reads',
       title = 'Assessing the quality of the dataset using number of reads',
       caption = 'Data from refine.bio\nAccession ID: SRP074247') +
  
  theme(plot.title = element_text(hjust = 0.5),
        axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1),
        legend.position = 'none',
        plot.caption = element_text(face = 'italic')) +
  
  scale_fill_manual(values = c('28' = '#FA8633',
                               '36' = '#1C6C7F',
                               '97' = '#9A6DA3'))
```

